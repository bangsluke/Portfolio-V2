---
import ProjectItem from "./ProjectItem.astro";
import Heading from "../ui/Heading.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from 'astro:content';

// Get all projects from the local content folder
const projects = await getCollection('projects');

// Sort projects by dateStart date (newest first)
const sortedProjects = projects
  .sort((a, b) => {
    // Sort by dateStart date, fallback to dateEnd date, then alphabetically
    const dateA = a.data.dateStart || a.data.dateEnd || new Date(0);
    const dateB = b.data.dateStart || b.data.dateEnd || new Date(0);
    
    if (dateA instanceof Date && dateB instanceof Date) {
      return dateB.getTime() - dateA.getTime();
    }
    
    // Fallback to alphabetical sorting by slug (filename)
    return a.slug.localeCompare(b.slug);
  });
---

<section class="py-8 px-8 max-md:py-4 mb-4 scroll-m-16" id="projects">
  <div class="flex flex-col pt-8 max-w-4xl mx-auto">
    <div class="flex gap-4 items-center justify-center">
      <Icon class="text-3xl dark:text-white text-blacktext" name="code" />
      <Heading text="" textGradient="Projects" level={2} />
    </div>

    <div class="relative max-md:mt-0 mt-8" aria-label="Projects">
      <ol class="relative mt-10">
        {
          sortedProjects.map((project, index) => (
            <li>
              <article
                role="article"
                aria-labelledby={`project-title-${index}`}
              >
                <div
                  class="flex flex-col gap-2 text-zinc-00 dark:text-zinc-300 md:col-span-3"
                  aria-describedby={`project-title-${index}`}
                >
                  <ProjectItem 
                    {...project.data}
                    name={project.data.name ?? project.slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                  />
                </div>
              </article>
            </li>
          ))
        }
      </ol>
    </div>
  </div>
</section> 