---
import ProjectCard from './ProjectCard.astro';
import Heading from '../ui/Heading.astro';
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';

// Get all projects from the local content folder
const projects = await getCollection('projects');

// Sort projects by dateStart date (newest first)
const sortedProjects = projects.sort((a, b) => {
	// Sort by dateStart date, fallback to dateEnd date, then alphabetically
	const dateA = a.data.dateStart || a.data.dateEnd || new Date(0);
	const dateB = b.data.dateStart || b.data.dateEnd || new Date(0);

	if (dateA instanceof Date && dateB instanceof Date) {
		return dateB.getTime() - dateA.getTime();
	}

	// Fallback to alphabetical sorting by slug (filename)
	return a.slug.localeCompare(b.slug);
});

// Show only first 6 projects
const displayedProjects = sortedProjects.slice(0, 6);
---
<section class="py-8 px-8 max-md:py-4 mb-4 scroll-m-16" id="projects">
	<div class="flex flex-col pt-8 max-w-7xl mx-auto">
		<div class="flex gap-4 items-center justify-center">
			<Icon class="text-3xl dark:text-white text-blacktext" name="code" />
			<Heading text="" textGradient="Projects " level={2} />
		</div>

		<div class="relative max-md:mt-0 mt-8" aria-label="Projects">
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
				{displayedProjects.map((project) => (
					<ProjectCard
						name={project.data.name ?? project.slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
						imageURL={project.data.imageURL}
						technologies={project.data.technologies}
						shortDescription={project.data.shortDescription}
						slug={project.slug}
					/>
				))}
			</div>
			{sortedProjects.length > 6 && (
				<div class="flex justify-center mt-12">
					<a href="/portfolio/projects" class="bg-mint-400 hover:bg-mint-500 text-black font-bold px-8 py-3 rounded-full transition-all duration-300 text-lg">
						See more projects
					</a>
				</div>
			)}
		</div>
	</div>
</section>
