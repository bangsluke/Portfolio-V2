---
import { Icon } from 'astro-icon/components';
---

<button
	id="themeToggle"
	class="hover:cursor-pointer hover:text-theme-400 transition-all">
	<Icon name="sun" class="sun" />
	<Icon name="moon" class="moon" />
</button>

<style>
	#themeToggle {
		border: 0;
		background: none;
	}
	.sun {
		display: block;
	}
	.moon {
		display: none;
	}

	:global(.dark) .sun {
		display: none;
	}
	:global(.dark) .moon {
		display: block;
	}
</style>

<script is:inline>
	// Listen for changes in system preferences
	window
		.matchMedia('(prefers-color-scheme: dark)')
		.addEventListener('change', e => {
			// Only update theme if user hasn't set a preference
			if (!localStorage.getItem('theme')) {
				if (e.matches) {
					document.documentElement.classList.add('dark');
				} else {
					document.documentElement.classList.remove('dark');
				}
			}
		});

	const handleToggleClick = () => {
		const element = document.documentElement;
		element.classList.toggle('dark');

		const isDark = element.classList.contains('dark');
		// Always store user preference when they click the toggle
		localStorage.setItem('theme', isDark ? 'dark' : 'light');
		console.log('Theme toggled to:', isDark ? 'dark' : 'light');
	};

	document
		.getElementById('themeToggle')
		.addEventListener('click', handleToggleClick);
</script>
