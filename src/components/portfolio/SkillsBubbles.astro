---
import { getCollection } from 'astro:content';
import { processContent } from '../../utils/content-processor';
import SkillsBubbleChart from './SkillsBubbleChart';

// Get all skills and projects from the local content folders
const skills = await getCollection('skills');
const projects = await getCollection('projects');

// Process skills to include processed descriptions
const processedSkills = skills.map(skill => ({
	...skill,
	data: {
		...skill.data,
		skillDescription: processContent(skill.data.skillDescription || ''),
	},
}));

// Get the class attribute from the parent component
const { class: className } = Astro.props;
---

<section class={`w-full h-full ${className || ''}`}>
	<!-- SEO-accessible skills list for web crawlers -->
	<div class="sr-only" aria-hidden="true">
		<h2>Technical Skills and Technologies</h2>
		<p>Professional skills and technologies I work with:</p>
		<ul>
			{
				skills.map(skill => (
					<li>
						<strong>{skill.data.name || skill.slug}</strong>
						{skill.data.skillDescription && (
							<span>
								: {skill.data.skillDescription.replace(/<[^>]*>/g, '')}
							</span>
						)}
					</li>
				))
			}
		</ul>
	</div>

	<SkillsBubbleChart
		client:only="preact"
		skills={processedSkills}
		projects={projects}
	/>
</section>
