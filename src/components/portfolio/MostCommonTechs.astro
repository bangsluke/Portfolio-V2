---
import SkillPill from '../ui/SkillPill.astro';

interface Props {
	variant?: 'default' | 'center';
	size?: 'xs' | 'md';
	techData: {
		techs: Array<{
			name: string;
			count: number;
			projects: string[];
			tags: string[];
		}>;
	};
}

const { variant = 'default', size = 'md', techData } = Astro.props;

// Get initial top 10 (most used)
const initialTopTechs = techData.techs.slice(0, 10);

// Base classes
const baseClasses = 'flex flex-wrap gap-4 max-lg:gap-1 grid-auto-efe items-center content-center';
const variantClasses = {
	default: 'cursor-default',
	center: 'justify-center cursor-default',
};
const classes = `${baseClasses} ${variantClasses[variant]}`;
---

<div class="flex flex-col gap-4 h-full">
	<!-- Technologies Grid -->
	<div class={`${classes} h-full flex-1`} id="techs-grid">
		{initialTopTechs.map((tech, index) => (
			<div class="relative group/tech">
				<!-- Skill Pill using the SkillPill component -->
				<SkillPill 
					skillName={tech.name}
					size="md"
					variant="theme"
					className="cursor-default"
					projects={tech.projects}
					disableTooltip={true}
				/>

				<!-- Enhanced tooltip showing usage count and projects -->
				<div
					class={`absolute left-1/2 transform -translate-x-1/2 opacity-0 group-hover/tech:opacity-100 group-active/tech:opacity-100 transition-opacity duration-300 pointer-events-none whitespace-nowrap z-10 ${
						index < 5 ? 'top-full mt-2' : 'bottom-full mb-2'
					}`}>
					<div class="global-tooltip max-w-xs">
						<div class="global-tooltip-content">
							<div class="text-sm font-medium mb-1">
								Used in {tech.count} project{tech.count > 1 ? 's' : ''}
							</div>
							{tech.projects.length > 0 && (
								<div class="text-xs text-zinc-300">
									<div class="font-medium mb-1">Projects:</div>
									<div class="space-y-1">
										{tech.projects.slice(0, 3).map((project) => (
											<div class="truncate">â€¢ {project}</div>
										))}
										{tech.projects.length > 3 && (
											<div class="text-zinc-400">
												... and {tech.projects.length - 3} more
											</div>
										)}
									</div>
								</div>
							)}
						</div>
						<div
							class={`absolute left-1/2 transform -translate-x-1/2 global-tooltip-arrow ${
								index < 5
									? 'global-tooltip-arrow-top'
									: 'global-tooltip-arrow-bottom'
							}`}
						/>
					</div>
				</div>
			</div>
		))}
	</div>
</div>
