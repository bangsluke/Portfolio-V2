---
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';
import EducationTimelineItem from '../components/portfolio/EducationTimelineItem.astro';
import Heading from '../components/ui/Heading.astro';
import Layout from '../layouts/Layout.astro';

// Get all education from the local content folder
const education = await getCollection('educations');

// Sort education by dateStart date (newest first)
const sortedEducation = education.sort((a, b) => {
	// Sort by dateStart date, fallback to dateEnd date, then alphabetically
	const dateA = a.data.dateStart || a.data.dateEnd || new Date(0);
	const dateB = b.data.dateStart || b.data.dateEnd || new Date(0);

	if (dateA instanceof Date && dateB instanceof Date) {
		return dateB.getTime() - dateA.getTime();
	}

	// Fallback to alphabetical sorting by slug (filename)
	return a.slug.localeCompare(b.slug);
});

const pageTitle = 'Education - bangsluke Portfolio';
const description = 'Complete education timeline';
const ogimage = {
	url: '/images/siteImage.webp',
	alt: 'Education Timeline',
};
---

<Layout pageTitle={pageTitle} description={description} ogimage={ogimage}>
	<div
		class="min-h-screen"
		style="background: linear-gradient(45deg, var(--color-theme-500-rgba-001) 10.79%, var(--color-theme-500-rgba-003) 40.92%, var(--color-theme-500-rgba-001) 90.35%)">
		<!-- Header -->
		<div class="pt-16">
			<div class="max-w-4xl mx-auto px-8 text-center max-sm:max-w-full">
				<!-- Top Back Button -->
				<div class="mb-8 text-center">
					<a
						href="/"
						class="inline-flex items-center text-theme-400 hover:text-theme-300 transition-colors">
						<svg
							class="w-5 h-5 mr-2"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 19l-7-7 7-7"></path>
						</svg>
						Back to Portfolio
					</a>
				</div>

				<div class="flex gap-4 items-center justify-center mb-4">
					<Icon class="text-4xl dark:text-white" name="education" />
					<Heading text="" textGradient="Education" level={1} />
				</div>
				<p class="dark:text-white/90 text-lg max-w-2xl mx-auto">
					Complete timeline of my educational background and academic
					achievements
				</p>
			</div>
		</div>

		<!-- Timeline -->
		<section class="py-16 px-8">
			<div class="max-w-4xl mx-auto max-sm:max-w-full">
				<div class="relative" aria-label="Complete education experience">
					<ol class="relative mt-10 max-sm:mt-6">
						{
							sortedEducation.map((education, index) => (
								<li>
									<article
										role="article"
										aria-labelledby={`education-title-${index}`}>
										<div
											class="flex flex-col gap-2 text-zinc-700 dark:text-zinc-300 md:col-span-3"
											aria-describedby={`education-title-${index}`}>
											<EducationTimelineItem
												{...education.data}
												name={
													education.data.name ||
													education.slug
														.replace(/-/g, ' ')
														.replace(/\b\w/g, l => l.toUpperCase())
												}
											/>
										</div>
									</article>
								</li>
							))
						}
					</ol>
				</div>
			</div>
		</section>

		<!-- Bottom Back Button -->
		<section class="py-8 px-8 max-md:py-4">
			<div class="max-w-7xl mx-auto">
				<div class="text-center">
					<a
						href="/"
						class="inline-flex items-center text-theme-400 hover:text-theme-300 transition-colors">
						<svg
							class="w-5 h-5 mr-2"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 19l-7-7 7-7"></path>
						</svg>
						Back to Portfolio
					</a>
				</div>
			</div>
		</section>
	</div>
</Layout>
